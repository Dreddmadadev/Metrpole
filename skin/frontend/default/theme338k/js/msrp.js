window.Catalog||(window.Catalog={}),Catalog.Map={helpLinks:[],active:!1,addHelpLink:function(t,o,e,i,a){if("string"==typeof t&&(t=$$(t)[0]),t){var r={link:t},p=!1;if("string"==typeof o&&o&&(r.title=o,p=!0),("string"==typeof e&&e||"object"==typeof e&&e)&&(r.price=e,p=!0),"string"==typeof i&&i&&(r.msrp=i,p=!0),"string"==typeof a&&a?r.cartLink=a:a&&a.url&&(r.cartLink=a.url,a.qty&&(r.qty=a.qty),a.notUseForm&&(r.notUseForm=a.notUseForm)),p){var d=this.helpLinks.push(r)-1;Event.observe(t,"click",this.showHelp.bind(this.helpLinks[d]))}else this.setGotoView(t,a);return r}},setGotoView:function(t,o){$(t).stopObserving("click"),t.href=o,window.opener?Event.observe(t,"click",function(t){setPLocation(this.href,!0),Catalog.Map.hideHelp(),t.stop()}):Event.observe(t,"click",function(t){setLocation(this.href),Catalog.Map.hideHelp(),window.opener.focus(),t.stop()})},showSelects:function(){var t=document.getElementsByTagName("select");for(i=0;i<t.length;i++)t[i].style.visibility="visible"},hideSelects:function(){var t=document.getElementsByTagName("select");for(i=0;i<t.length;i++)t[i].style.visibility="hidden"},showHelp:function(t){var o=$("map-popup"),e=void 0===document.body.style.maxHeight;if(o){var i=$$("body")[0];if(o.parentNode!=i){o.remove(),i.insert(o);var a=o.select(".paypal-logo > a > img")[0];a&&(a.src=a.src)}if(this!=Catalog.Map&&Catalog.Map.active!=this.link){o.style.display="none",o.offsetPosition||(o.offsetPosition={left:0,top:0}),o.removeClassName("map-popup-right"),o.removeClassName("map-popup-left"),Element.getWidth(i)<t.pageX+Element.getWidth(o)?o.addClassName("map-popup-left"):t.pageX-Element.getWidth(o)<0&&o.addClassName("map-popup-right"),o.style.left=t.pageX-Element.getWidth(o)/2-45+"px",o.style.top=t.pageY+10+"px";var r=$("map-popup-heading");void 0!==this.title?(Element.update(r,this.title),$(r).show()):$(r).hide();var p=$("map-popup-msrp-box");void 0!==this.msrp?(Element.update($("map-popup-msrp"),this.msrp),$(p).show()):$(p).hide();var d=$("map-popup-price-box");if(void 0!==this.price){var s="object"==typeof this.price?this.price.innerHTML:this.price;Element.update($("map-popup-price"),s),$(d).show()}else $(d).hide();var n=$("map-popup-button");if(void 0!==this.cartLink)"undefined"==typeof productAddToCartForm||this.notUseForm?(Catalog.Map.setGotoView(n,this.cartLink),productAddToCartForm=$("product_addtocart_form_from_popup")):(this.qty&&(productAddToCartForm.qty=this.qty),n.stopObserving("click"),n.href=this.cartLink,Event.observe(n,"click",function(t){productAddToCartForm.action=this.href,productAddToCartForm.submit(this)})),productAddToCartForm.action=this.cartLink,$("map-popup-product-id").value=this.product_id,$(n).show(),$$(".additional-addtocart-box").invoke("show");else $(n).hide(),$$(".additional-addtocart-box").invoke("hide");var c=$("map-popup-text"),l=$("map-popup-text-what-this"),u=$("map-popup-content");p.visible()||d.visible()||n.visible()?($(l).hide(),$(c).show(),$(c).addClassName("map-popup-only-text"),$(u).show().setStyle({visibility:"visible"}),$("product_addtocart_form_from_popup").show()):($(c).hide(),$(l).show(),$(l).removeClassName("map-popup-only-text"),$(u).hide().setStyle({visibility:"hidden"}),$("product_addtocart_form_from_popup").hide()),$(o).show(),e&&Catalog.Map.hideSelects();var m=$("map-popup-close");m&&($(m).stopObserving("click"),Event.observe(m,"click",Catalog.Map.showHelp.bind(this)),Catalog.Map.active=this.link)}else $(o).hide(),e&&Catalog.Map.showSelects(),Catalog.Map.active=!1;Event.stop(t)}},hideHelp:function(){var t=$("map-popup");if(t){var o=void 0===document.body.style.maxHeight;$(t).hide(),o&&Catalog.Map.showSelects(),Catalog.Map.active=!1}},bindProductForm:function(){if("undefined"!=typeof productAddToCartForm&&productAddToCartForm)productAddToCartFormOld=productAddToCartForm,productAddToCartForm=new VarienForm("product_addtocart_form_from_popup"),productAddToCartForm.submitLight=productAddToCartFormOld.submitLight;else{if(!$("product_addtocart_form_from_popup"))return!1;"undefined"==typeof productAddToCartForm&&(productAddToCartForm=new VarienForm("product_addtocart_form_from_popup"))}productAddToCartForm.submit=function(t,o){if("undefined"!=typeof productAddToCartFormOld&&productAddToCartFormOld)return Catalog.Map.active&&Catalog.Map.hideHelp(),productAddToCartForm.qty&&$("qty")&&($("qty").value=productAddToCartForm.qty),parentResult=productAddToCartFormOld.submit(),!1;if(window.opener){var e=t;new Ajax.Request(this.form.action,{parameters:{isAjax:1,method:"GET"},onSuccess:function(t){window.opener.focus(),e&&e.href&&(setPLocation(e.href,!0),Catalog.Map.hideHelp())}})}else if(this.validator.validate()){var i=this.form,a=i.action;o&&(i.action=o),i.getAttribute("action")||(i.action=productAddToCartForm.action);try{this.form.submit()}catch(t){throw this.form.action=a,t}this.form.action=a,t&&"undefined"!=t&&(t.disabled=!0)}}.bind(productAddToCartForm)}},Event.observe(window,"resize",function(t){Catalog.Map.active&&Catalog.Map.showHelp(t)}),$(document).observe("bundle:reload-price",function(t){var o=t.memo.bundle;if(!Number(o.config.isMAPAppliedDirectly)&&!Number(o.config.isFixedPrice)){var e=!1;try{for(var i in o.config.selected){if(o.config.options[i]&&o.config.options[i].selections)for(var a=o.config.options[i].selections,r=0,p=o.config.selected[i].length;r<p;r++){var d=o.config.selected[i][r];if(Number(a[d].canApplyMAP)){e=!0;break}}if(e)break}}catch(t){e=!0}e?($$(".full-product-price").each(function(t){$(t).hide()}),$$(".map-info").each(function(t){$(t).show()}),t.noReloadPrice=!0):($$(".full-product-price").each(function(t){$(t).show()}),$$(".map-info").each(function(t){$(t).hide()}))}});